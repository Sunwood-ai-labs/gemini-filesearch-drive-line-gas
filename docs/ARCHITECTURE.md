# 🏗️ システムアーキテクチャ概要

このドキュメントでは、Gemini File Search × Google Drive × LINE × GAS プロジェクトの構成要素と連携フローを説明します。

## 🔌 主要コンポーネント
- **Google Apps Script (GAS)**: 全体のオーケストレーションを担当し、LINE からのメッセージを受け取って処理します。
- **LINE Messaging API**: ユーザーとのインタラクションを提供し、ボット宛ての検索リクエストを転送します。
- **Google Drive API**: 指定フォルダ内のファイルを検索し、メタデータや共有リンクを取得します。
- **Google Gemini API**: ユーザーの検索クエリを自然言語で補完・リライトし、より精度の高い検索パラメータへ変換します。

## 🔁 データフロー
1. ユーザーが LINE で検索キーワードを送信。
2. GAS が Webhook を受信し、Gemini API にクエリの意図を解析させる。
3. 解析結果を使って Google Drive API でファイル検索を実行。
4. 検索結果をフォーマットし、必要に応じて Gemini API に要約を依頼。
5. 要約とファイルリンクを LINE でユーザーへ返信。

## 🧱 スクリプト構成
- `code.gs`: Webhook エントリポイント、Gemini / Drive API 呼び出しロジック、レスポンス生成を実装します。
- `appsscript.json`: GAS プロジェクト設定 (スコープ、実行権限など) を定義します。

## 🛡️ セキュリティ考慮
- 機密情報は GAS プロパティサービスで管理し、コードには直接記述しません。
- LINE の署名検証を必須化し、リクエストの正当性を担保します。
- Drive API のアクセス範囲を必要最小限に制限します。

## 🔮 今後の拡張ポイント
- Firestore 等を組み合わせた検索履歴ログの保存。
- Gemini を利用した意図分類の精度向上とマルチモーダル対応。
- 管理者用ダッシュボードの追加。
